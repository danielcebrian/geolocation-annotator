var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d};Annotator.Plugin.Geolocation=(function(b){__extends(a,b);function a(){this.pluginSubmit=__bind(this.pluginSubmit,this);this.updateViewer=__bind(this.updateViewer,this);_ref=a.__super__.constructor.apply(this,arguments);return _ref}a.prototype.field=null;a.prototype.input=null;a.prototype.pluginInit=function(){console.log("Geolocation-pluginInit");if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Add my current location"),submit:this.pluginSubmit,});var d=this;$(this.field).mouseup(function(){d.getCurrentPosition(d)});var c=this.annotator.viewer.addField({load:this.updateViewer,});return this.input=$(this.field).find(":input")};a.prototype.pluginSubmit=function(e,d){var c=$(e).find("input:checked").length==1?true:false;if(c){if(typeof d.geolocation=="undefined"){d.geolocation={}}d.geolocation.longitude=this.longitude;d.geolocation.latitude=this.latitude;d.geolocation.altitude=this.altitude;d.geolocation.accuracy=this.accuracy;if(typeof this.goterror!="undefined"&&this.goterror){alert("You want to save your current location. But you did not accept the location in your browser or maybe your browser is not able to use your current location")}this.publish("newgeolocation",[e,d])}return d.geolocation};a.prototype.getCurrentPosition=function(c){var e={enableHighAccuracy:true,timeout:5000,maximumAge:0};function f(g){c.longitude=g.coords.longitude;c.latitude=g.coords.latitude;c.altitude=g.coords.altitude;c.accuracy=g.coords.accuracy}function d(g){c.goterror=true;console.warn("ERROR("+g.code+"): "+g.message)}navigator.geolocation.getCurrentPosition(f,d,e)};a.prototype.updateViewer=function(f,d){$(f).remove();var c=typeof d.geolocation!="undefined";if(c){var g=$(this.annotator.viewer.element.find(".annotator-controls")).parent();g.prepend('<button title="The user annotation location" class="geolocation-viewer-annotator">');var h=g.find(".geolocation-viewer-annotator"),e=this;h.click(function(){g.append('<div class="map-viewer-annotator">');var i=g.find(".map-viewer-annotator")[0],k=d.geolocation.latitude,j=d.geolocation.longitude;e.showPosition(i,k,j)});h.addClass("annotator-visible");setTimeout((function(){return h.removeClass("annotator-visible")}),500)}};a.prototype.showPosition=function(d,i,g){var f=i+","+g,e=parseInt($(d).css("width")),c=parseInt($(d).css("height"));var h="http://maps.googleapis.com/maps/api/staticmap?center="+f+"&zoom=14&size="+e+"x"+c+"&sensor=false&markers=color:green%7Clabel:G%7C"+f;d.innerHTML="<img src='"+h+"'>";d.style.visibility="hidden";setInterval(function(){d.style.visibility="visible";d.style.width=$(d).find("img").css("width")},100)};return a})(Annotator.Plugin);